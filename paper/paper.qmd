---
title: "How Urban Pollinator Garden Types and Locations Influence Community-Led Grant Success in Toronto"
subtitle: "Insights from Bayesian Analysis on Funding Outcomes for PollinateTO Projects."
author: 
  - Aliza Abbas Mithwani
thanks: "Code and data are available at: [https://github.com/alizamithwani/PollinateTO.git]"
date: today
date-format: long
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(palmerpenguins)
```


# Introduction

## Overview
Urban biodiversity plays a crucial role in sustaining ecosystem health, yet cities face challenges in designing equitable and effective strategies to protect pollinators. Toronto’s PollinateTO initiative seeks to address this by funding community-led projects that create and enhance publicly visible pollinator gardens. Since its inception in 2019, the program has supported over 190 projects, resulting in approximately 500 gardens and 25,500 m² of pollinator habitat. While these efforts align with the city’s Pollinator Protection and Biodiversity Strategies, the allocation patterns of these grants remain an open question. Specifically, understanding whether certain types of gardens (e.g., rain gardens, boulevard gardens) or locations (e.g., Neighbourhood Improvement Areas) are more likely to receive funding can provide valuable insights into optimizing resources and maximizing program impact.

## Estimand
To address this question, this paper investigates the relationship between garden characteristics and PollinateTO funding decisions. Our analysis focuses on how variables such as garden type, location, and community engagement strategies influence both the frequency and magnitude of funding allocations. The estimand centers on whether specific garden features are associated with higher funding likelihoods and amounts, filling a critical gap in understanding how urban biodiversity programs distribute resources.

## Results
Our results reveal that certain garden types, such as_______, are more likely to secure funding, particularly in underserved areas identified as _______. We also find that projects emphasizing ______ receive higher allocations, highlighting the program’s alignment with broader engagement and ecological priorities. These findings offer actionable insights into how urban biodiversity initiatives can balance ecological goals with social equity considerations.

## Significance
The implications of this study extend beyond Toronto, providing a framework for other cities seeking to implement or refine pollinator protection strategies. By shedding light on funding allocation patterns, this research informs policymakers and urban planners on how to enhance the effectiveness and equity of biodiversity programs. These insights contribute to the growing body of literature on sustainable urban development and community-driven ecological stewardship.

## Telegraphing
The remainder of this paper is structured as follows. Section 2 describes the data used in the analysis, including its sources, key features, and considerations regarding measurement and visualization. Section 3 outlines the methodology, detailing the data visualization techniques employed and the justification for using a Bayesian logistic regression model to analyze the relationship between garden characteristics and funding outcomes. Section 4 presents the results, including model validation and key findings. Section 5 offers a discussion of the results, focusing on their implications through key points, followed by an examination of the study's limitations and suggested future steps for further exploration. Section 6 concludes the paper. The Appendix provides supplementary materials, including raw data previews, data feature definitions, data visualizations, and technical model details such as posterior predictive checks, MCMC convergence diagnostics, and additional figures.


@sec-data....






# Data {#sec-data}
## Software Packages
We use the statistical programming language R [@citeR].... Our data [@shelter].... Following @tellingstories, we consider...
## Data Source

## Data Features

## Data Measurement
	
Some paragraphs about how we go from a phenomena in the world to an entry in the dataset.

## Data Consideration

## Methodology

## Data Visualization

Add graphs, tables and text. Use sub-sub-headings for each outcome variable or update the subheading to be singular.



Some of our data is of penguins (@fig-bills), from @palmerpenguins.

```{r}
#| label: fig-bills
#| fig-cap: Bills of penguins
#| echo: false

#### Workspace setup ####
library(tidyverse)
library(ggplot2)
library(dplyr)
library(knitr)
library(arrow)

#### Read data ####
PT_analysis_data <- read_parquet("../data/02-analysis_data/PT_analysis_data.parquet")

# Summarize the data by year to get the total number of gardens and average garden size per year
PT_summary <- PT_analysis_data %>%
  group_by(year_funded) %>%
  summarise(
    total_gardens = sum(number_of_gardens, na.rm = TRUE), # Summing number of gardens per year
    avg_garden_size = mean(estimated_garden_size, na.rm = TRUE) # Calculating average garden size
  )

# Create the line chart with two y-axes (total gardens and average size)
ggplot(PT_summary, aes(x = year_funded)) +
  geom_line(aes(y = total_gardens), color = "blue", linewidth = 1.2, linetype = "solid") + 
  geom_line(aes(y = avg_garden_size), color = "red", linewidth = 1.2, linetype = "dashed") +
  scale_y_continuous(
    name = "Total Number of Gardens", 
    sec.axis = sec_axis(~., name = "Average Garden Size (Estimated)")
  ) +
  labs(
    title = "Trend of Garden Size and Number Over Time",
    x = "Year Funded",
    y = "Total Number of Gardens"
  ) +
  theme_minimal() +
  theme(
    axis.title.y.right = element_text(color = "red"),
    axis.text.y.right = element_text(color = "red")
  )

# Summarize the data to get the count of garden types by year
PT_summary <- PT_analysis_data %>%
  group_by(year_funded, garden_type) %>%
  summarise(
    garden_count = n(), # Count the number of occurrences for each garden type per year
    .groups = "drop"
  )

# Create the bar chart
ggplot(PT_summary, aes(x = year_funded, y = garden_count, fill = garden_type)) +
  geom_bar(stat = "identity", position = "stack") + # Stacked bar chart
  scale_fill_brewer(palette = "Set3") + # Use a color palette for clarity
  labs(
    title = "Distribution of Garden Types Funded Over Time",
    x = "Year Funded",
    y = "Number of Gardens",
    fill = "Garden Type"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(hjust = 1) # Rotate x-axis labels for readability
  )

# Add a log-transformed column for garden size
PT_analysis_data <- PT_analysis_data %>%
  mutate(log_garden_size = log1p(estimated_garden_size)) # log1p handles zero values safely

# Use the log-transformed column in the boxplot
ggplot(PT_analysis_data, aes(x = nia_or_en, y = log_garden_size, fill = nia_or_en)) +
  geom_boxplot(outlier.color = "red", outlier.shape = 16, notch = FALSE) +
  scale_fill_brewer(palette = "Pastel1") +
  labs(
    title = "Log-Transformed Garden Sizes by Neighborhood Type",
    x = "Neighborhood Type (NIA or EN)",
    y = "Log of Estimated Garden Size",
    fill = "Neighborhood Type"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)
  )

# Filter for Indigenous-Led gardens only
PT_indigenous <- PT_analysis_data %>%
  filter(is_indigenous_garden == 1) %>%
  group_by(nia_or_en) %>%
  summarise(count = n(), .groups = "drop")

# Create a bar chart
ggplot(PT_indigenous, aes(x = nia_or_en, y = count, fill = nia_or_en)) +
  geom_bar(stat = "identity") +
  scale_fill_brewer(palette = "Set2") +
  labs(
    title = "Count of Indigenous-Led Gardens by Neighborhood Type",
    x = "Neighborhood Type (NIA or EN)",
    y = "Number of Indigenous-Led Gardens",
    fill = "Neighborhood Type"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)
  )

# Summarize the data
PT_summary_table <- PT_analysis_data %>%
  group_by(nia_or_en) %>%
  summarise(
    Total_Gardens = n(), # Total number of gardens in each neighborhood type
    Indigenous_Gardens = sum(is_indigenous_garden), # Count of Indigenous-led gardens
    Non_Indigenous_Gardens = Total_Gardens - Indigenous_Gardens, # Count of Non-Indigenous gardens
    Proportion_Indigenous = (Indigenous_Gardens / Total_Gardens) * 100, # Proportion of Indigenous gardens
    .groups = "drop"
  )

# Display the table
PT_summary_table %>%
  kable(
    caption = "Summary of Gardens by Neighborhood Type",
    col.names = c(
      "Neighborhood Type (NIA or EN)", 
      "Total Gardens", 
      "Indigenous-Led Gardens", 
      "Non-Indigenous Gardens", 
      "Proportion Indigenous (%)"
    )
  )

# Create the scatter plot with a trendline
ggplot(PT_analysis_data, aes(x = log1p(estimated_garden_size), y = log1p(number_of_gardens))) +
  geom_point(color = "blue", alpha = 0.6) + # Scatter points
  geom_smooth(method = "lm", color = "red", se = TRUE) + # Trendline (linear regression)
  labs(
    title = "Log-Transformed Relationship Between Garden Size and Number of Gardens",
    x = "Log(Estimated Garden Size + 1)",
    y = "Log(Number of Gardens + 1)",
    caption = "Source: PollinateTO Dataset"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5), # Center the title
    axis.text.x = element_text(angle = 45, hjust = 1) # Rotate x-axis labels if needed
  )
  
  
  
```

Talk more about it.

And also planes (@fig-planes). (You can change the height and width, but don't worry about doing that until you have finished every other aspect of the paper - Quarto will try to make it look nice and the defaults usually work well once you have enough text.)

```{r}
#| label: fig-planes
#| fig-cap: Relationship between wing length and width
#| echo: false
#| warning: false
#| message: false

#analysis_data <- read_csv(here::here("data/02-analysis_data/analysis_data.csv"))

#analysis_data |> 
#  ggplot(aes(x = width, y = length)) +
#  geom_point(alpha = 0.8) +
#  theme_minimal() +
#  labs(x = "Wing width (mm)",
#       y = "Wing length (mm)")
```

Talk way more about it. 

## Predictor variables

Add graphs, tables and text.

Use sub-sub-headings for each outcome variable and feel free to combine a few into one if they go together naturally.








# Model

In the analysis, I used a Bayesian Logistic Regression Model to examine the relationship between garden size and other factors like the type of garden, the year the project was funded, the neighborhood type (emerging neighborhood, EN vs neighborhood improvement area, NIA), and if it is an indigenous-led project.

The goal of our modelling strategy is twofold. Firstly,...

Here we briefly describe the Bayesian analysis model used to investigate... Background details and diagnostics are included in [Appendix -@sec-model-details].

## Model set-up

Define $y_i$ as the number of seconds that the plane remained aloft. Then $\beta_i$ is the wing width and $\gamma_i$ is the wing length, both measured in millimeters.  

\begin{align} 
y_i|\mu_i, \sigma &\sim \mbox{Normal}(\mu_i, \sigma) \\
\mu_i &= \alpha + \beta_i + \gamma_i\\
\alpha &\sim \mbox{Normal}(0, 2.5) \\
\beta &\sim \mbox{Normal}(0, 2.5) \\
\gamma &\sim \mbox{Normal}(0, 2.5) \\
\sigma &\sim \mbox{Exponential}(1)
\end{align}

We run the model in R [@citeR] using the `rstanarm` package of @rstanarm. We use the default priors from `rstanarm`.


### Model justification

We expect a positive relationship between the size of the wings and time spent aloft. In particular...

We can use maths by including latex between dollar signs, for instance $\theta$.


# Results

Our results are summarized in @tbl-modelresults.

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false

library(rstanarm)

first_model <-
  readRDS(file = here::here("models/first_model.rds"))
```

```{r}
#| echo: false
#| eval: true
#| label: tbl-modelresults
#| tbl-cap: "Explanatory models of flight time based on wing width and wing length"
#| warning: false

#modelsummary::modelsummary(
#  list(
#    "First model" = first_model
 # ),
 # statistic = "mad",
 # fmt = 2
#)
```




# Discussion

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

Please don't use these as sub-heading labels - change them to be what your point actually is.

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional data details

# Model details {#sec-model-details}

## Posterior predictive check

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check. This shows...

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. This shows... 

```{r}
#| eval: true
#| echo: false
#| message: false
#| warning: false
#| label: fig-ppcheckandposteriorvsprior
#| layout-ncol: 2
#| fig-cap: "Examining how the model fits, and is affected by, the data"
#| fig-subcap: ["Posterior prediction check", "Comparing the posterior with the prior"]

#pp_check(first_model) +
#  theme_classic() +
#  theme(legend.position = "bottom")

#posterior_vs_prior(first_model) +
#  theme_minimal() +
 # scale_color_brewer(palette = "Set1") +
#  theme(legend.position = "bottom") +
#  coord_flip()
```

## Diagnostics

@fig-stanareyouokay-1 is a trace plot. It shows... This suggests...

@fig-stanareyouokay-2 is a Rhat plot. It shows... This suggests...

```{r}
#| echo: false
#| eval: true
#| message: false
#| warning: false
#| label: fig-stanareyouokay
#| fig-cap: "Checking the convergence of the MCMC algorithm"
#| fig-subcap: ["Trace plot", "Rhat plot"]
#| layout-ncol: 2

#plot(first_model, "trace")

#plot(first_model, "rhat")
```



\newpage


# References


