---
title: "Key Drivers of Community Garden Growth: Analyzing Trends in PollinateTO Funding Across Toronto’s Neighborhoods"
subtitle: "A Bayesian Approach to Understanding the Impact of Time, Type, and Location on Garden Size and Number."
author: 
  - Aliza Abbas Mithwani
thanks: "Code and data are available at: [https://github.com/alizamithwani/PollinateTO.git]"
date: today
date-format: long
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
format:
  pdf:
    toc: true
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

#### Workspace setup ####
library(tidyverse)
library(ggplot2)
library(dplyr)
library(knitr)
library(arrow)
```


# Introduction

## Overview
Urban biodiversity plays a crucial role in sustaining ecosystem health, yet cities face challenges in designing equitable and effective strategies to protect pollinators. Toronto’s PollinateTO initiative seeks to address this by funding community-led projects that create and enhance publicly visible pollinator gardens. Since its inception in 2019, the program has supported over 190 projects, resulting in approximately 500 gardens and 25,500 m² of pollinator habitat. While these efforts align with the city’s Pollinator Protection and Biodiversity Strategies, the allocation patterns of these grants remain an open question. Specifically, understanding whether certain types of gardens (e.g., rain gardens, boulevard gardens) or locations (e.g., Neighbourhood Improvement Areas) are more likely to receive funding can provide valuable insights into optimizing resources and maximizing program impact.

## Estimand
To address this question, this paper investigates the relationship between garden characteristics and PollinateTO funding decisions. Our analysis focuses on how variables such as garden type, location, and community engagement strategies influence both the frequency and magnitude of funding allocations. The estimand centers on whether specific garden features are associated with higher funding likelihoods and amounts, filling a critical gap in understanding how urban biodiversity programs distribute resources.

## Results
Our results reveal that certain garden types, such as_______, are more likely to secure funding, particularly in underserved areas identified as _______. We also find that projects emphasizing ______ receive higher allocations, highlighting the program’s alignment with broader engagement and ecological priorities. These findings offer actionable insights into how urban biodiversity initiatives can balance ecological goals with social equity considerations.

## Significance
The implications of this study extend beyond Toronto, providing a framework for other cities seeking to implement or refine pollinator protection strategies. By shedding light on funding allocation patterns, this research informs policymakers and urban planners on how to enhance the effectiveness and equity of biodiversity programs. These insights contribute to the growing body of literature on sustainable urban development and community-driven ecological stewardship.

## Telegraphing
The remainder of this paper is structured as follows. @sec-data describes the data used in the analysis, including its sources, key features, and considerations regarding measurement and visualization. Section 3 outlines the methodology, detailing the data visualization techniques employed and the justification for using a Bayesian logistic regression model to analyze the relationship between garden characteristics and funding outcomes. Section 4 presents the results, including model validation and key findings. Section 5 offers a discussion of the results, focusing on their implications through key points, followed by an examination of the study's limitations and suggested future steps for further exploration. Section 6 concludes the paper. The Appendix provides supplementary materials, including raw data previews, data feature definitions, data visualizations, and technical model details such as posterior predictive checks, MCMC convergence diagnostics, and additional figures.

# Data {#sec-data}
## Software Packages
We use the statistical programming language R [@citeR], rstanarm [@rstanarm], tidyverse [@tidyverse] Our data [@PTdata].... Following @tellingstories, we consider...

## Data Source
This study uses data from the PollinateTO Primary Project Garden Locations dataset, hosted on Toronto's Open Data Portal. The dataset provides information on community-led garden projects funded by PollinateTO, including geographic location, garden type, funding year, and other features relevant to understanding the distribution and characteristics of these initiatives. It is publicly accessible and serves as a vital resource for analyzing PollinateTO’s impact in Toronto neighborhoods.

## Data Features
The dataset includes several key variables:

YEAR_FUNDED: The year the project received funding from PollinateTO.
GARDEN_TYPE: Categories of gardens (e.g., food gardens, pollinator gardens, rain gardens).
NIA_OR_EN: Classification of garden location as part of a Neighbourhood Improvement Area (NIA), Emerging Neighborhood (EN), or other areas.
WARD_NAME: The city ward where the garden is located.
IS_INDIGENOUS_GARDEN: A binary variable indicating whether the garden is Indigenous-led.
PROJECT_NAME: Names assigned to specific garden projects.
LATITUDE and LONGITUDE: Geographic coordinates of each garden.
These features allow for diverse analyses, from exploring spatial trends to assessing equity and accessibility in funding distribution.

## Data Measurement*** (check key)
The dataset translates real-world community garden projects into structured entries by standardizing key attributes. For example:

YEAR_FUNDED records when projects were initiated, reflecting the temporal dimension of PollinateTO’s funding priorities.
GARDEN_TYPE is based on project applications, categorized to highlight garden purposes and ecological roles.
NIA_OR_EN and WARD_NAME capture the geographic and socioeconomic contexts of gardens, derived from city planning frameworks.
IS_INDIGENOUS_GARDEN identifies projects promoting Indigenous cultural or ecological knowledge, based on project self-identification during funding application.
The dataset provides structured snapshots of projects, enabling analysis of broader trends, equity impacts, and ecological contributions of urban greening initiatives.

## Data Consideration
Several considerations affect the dataset’s completeness and reliability:

Self-Reported Data: Much of the data, including garden types and Indigenous-led status, relies on self-reporting by project applicants.
Selection Bias: Funding decisions prioritize certain areas (e.g., NIAs), potentially overrepresenting them compared to other regions.
Temporal Incompleteness: The dataset spans 2019 to present, limiting analyses to recent funding trends.
Granularity: Certain variables, such as project outcomes or specific plant species, are not included, restricting the scope of ecological impact analysis.
Geographic Precision: While coordinates are provided, some garden boundaries and precise sizes may not be captured, introducing potential spatial analysis challenges.


## Methodology
Several considerations affect the dataset’s completeness and reliability:

Self-Reported Data: Much of the data, including garden types and Indigenous-led status, relies on self-reporting by project applicants.
Selection Bias: Funding decisions prioritize certain areas (e.g., NIAs), potentially overrepresenting them compared to other regions.
Temporal Incompleteness: The dataset spans 2019 to present, limiting analyses to recent funding trends.
Granularity: Certain variables, such as project outcomes or specific plant species, are not included, restricting the scope of ecological impact analysis.
Geographic Precision: While coordinates are provided, some garden boundaries and precise sizes may not be captured, introducing potential spatial analysis challenges.

## Data Visualization
To understand the data provided better, we visualize it using tables and graphs. To begin with, let's see how many gardens each type of neighborhood (NIA, EN or None) has and separate them by whether or not they are indigenous-led in @fig-IndNeiBoxPlot and @fig-IndNeiBarChart.

```{r}
#| label: fig-IndNeiBoxPlot
#| fig-cap: Summary of Gardens by Neighborhood Type
#| echo: false

#### Read data ####
PT_analysis_data <- read_parquet("../data/02-analysis_data/PT_analysis_data.parquet")

# Summarize the data
PT_summary_table <- PT_analysis_data %>%
  group_by(nia_or_en) %>%
  summarise(
    Total_Gardens = n(), # Total number of gardens in each neighborhood type
    Indigenous_Gardens = sum(is_indigenous_garden), # Count of Indigenous-led gardens
    Non_Indigenous_Gardens = Total_Gardens - Indigenous_Gardens, # Count of Non-Indigenous gardens
    Proportion_Indigenous = (Indigenous_Gardens / Total_Gardens) * 100, # Proportion of Indigenous gardens
    .groups = "drop"
  )

# Display the table
PT_summary_table %>%
  kable(
    col.names = c(
      "Neighborhood Type (NIA or EN)", 
      "Total Gardens", 
      "Indigenous-Led Gardens", 
      "Non-Indigenous Gardens", 
      "Proportion Indigenous (%)"
    )
  )
```

```{r}
#| label: fig-IndNeiBarChart
#| fig-cap: Distribution of Garden Types Funded Over Time
#| echo: false
# Filter for Indigenous-Led gardens only
PT_indigenous <- PT_analysis_data %>%
  filter(is_indigenous_garden == 1) %>%
  group_by(nia_or_en) %>%
  summarise(count = n(), .groups = "drop")

# Create a bar chart
ggplot(PT_indigenous, aes(x = nia_or_en, y = count, fill = nia_or_en)) +
  geom_bar(stat = "identity") +
  scale_fill_brewer(palette = "Set2") +
  labs(
    title = "Count of Indigenous-Led Gardens by Neighborhood Type",
    x = "Neighborhood Type (NIA or EN)",
    y = "Number of Indigenous-Led Gardens",
    fill = "Neighborhood Type"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "none"
  )
```

Next, we visualize the trend of garden sizes and numbers across time to examine the impact of the initiative over time in @fig-trendline.

```{r}
#| label: fig-trendline
#| fig-cap: Trend of Garden Size and Number Over Time
#| echo: false

# Summarize the data by year to get the total number of gardens and average garden size per year
PT_summary <- PT_analysis_data %>%
  group_by(year_funded) %>%
  summarise(
    total_gardens = sum(number_of_gardens, na.rm = TRUE), # Summing number of gardens per year
    avg_garden_size = mean(estimated_garden_size, na.rm = TRUE) # Calculating average garden size
  )

# Create the line chart with two y-axes (total gardens and average size)
ggplot(PT_summary, aes(x = year_funded)) +
  geom_line(aes(y = total_gardens), color = "blue", linewidth = 1.2, linetype = "solid") + 
  geom_line(aes(y = avg_garden_size), color = "red", linewidth = 1.2, linetype = "dashed") +
  scale_y_continuous(
    name = "Total Number of Gardens", 
    sec.axis = sec_axis(~., name = "Average Garden Size (Estimated)")
  ) +
  labs(
    x = "Year Funded",
    y = "Total Number of Gardens"
  ) +
  theme_minimal() +
  theme(
    axis.title.y.right = element_text(color = "red"),
    axis.text.y.right = element_text(color = "red")
  )
```
\newpage
Now, let's analyze the proportion of each garden type visually across time in @fig-distributiontype to see if certain garden types increased in number and proportion overtime, reflecting shifting funding priorities and initiatives.

```{r}
#| label: fig-distributiontype
#| fig-cap: Distribution of Garden Types Funded Over Time
#| echo: false

# Summarize the data to get the count of garden types by year
PT_summary <- PT_analysis_data %>%
  group_by(year_funded, garden_type) %>%
  summarise(
    garden_count = n(), # Count the number of occurrences for each garden type per year
    .groups = "drop"
  )

# Create the bar chart
ggplot(PT_summary, aes(x = year_funded, y = garden_count, fill = garden_type)) +
  geom_bar(stat = "identity", position = "stack") + # Stacked bar chart
  scale_fill_brewer(palette = "Set3") + # Use a color palette for clarity
  labs(
    x = "Year Funded",
    y = "Number of Gardens",
    fill = "Garden Type"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(hjust = 1) # Rotate x-axis labels for readability
  )
```
\newpage
To prevent outliars from making graphs unreadable, we use log-transformed garden sizes to analyze differences in garden sizes based on neighborhood type in @fig-neighborhoodsize. A boxplot is used to do this where the 3 neighborhood categories are EN (Emerging Neighborhoods), NIA (Neighborhood Improvement Areas) and None (neither EN nor NIA).

```{r}
#| label: fig-neighborhoodsize
#| fig-cap: Log-Transformed Garden Sizes by Neighborhood Type
#| echo: false
# Add a log-transformed column for garden size
PT_analysis_data <- PT_analysis_data %>%
  mutate(log_garden_size = log1p(estimated_garden_size)) # log1p handles zero values safely

# Use the log-transformed column in the boxplot
ggplot(PT_analysis_data, aes(x = nia_or_en, y = log_garden_size, fill = nia_or_en)) +
  geom_boxplot(outlier.color = "red", outlier.shape = 16, notch = FALSE) +
  scale_fill_brewer(palette = "Pastel1") +
  labs(
    x = "Neighborhood Type (NIA or EN)",
    y = "Log of Estimated Garden Size",
    fill = "Neighborhood Type"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "none"
  )
```
# Model
In the analysis, I used a Bayesian Logistic Regression Model to examine the relationship between garden size and other factors like the type of garden, the year the project was funded, the neighborhood type (emerging neighborhood, EN vs neighborhood improvement area, NIA), and if it is an indigenous-led project.

The goal of our modelling strategy is twofold. Firstly,...

Here we briefly describe the Bayesian analysis model used to investigate... Background details and diagnostics are included in [Appendix -@sec-model-details].

## Model set-up

Define $y_i$ as the number of seconds that the plane remained aloft. Then $\beta_i$ is the wing width and $\gamma_i$ is the wing length, both measured in millimeters.  

\begin{align} 
y_i|\mu_i, \sigma &\sim \mbox{Normal}(\mu_i, \sigma) \\
\mu_i &= \alpha + \beta_i + \gamma_i\\
\alpha &\sim \mbox{Normal}(0, 2.5) \\
\beta &\sim \mbox{Normal}(0, 2.5) \\
\gamma &\sim \mbox{Normal}(0, 2.5) \\
\sigma &\sim \mbox{Exponential}(1)
\end{align}

We run the model in R [@citeR] using the `rstanarm` package of @rstanarm. We use the default priors from `rstanarm`.


### Model justification

We expect a positive relationship between the size of the wings and time spent aloft. In particular...

We can use maths by including latex between dollar signs, for instance $\theta$.


# Results

Our results are summarized in @tbl-modelresults.

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false

library(rstanarm)

first_model <-
  readRDS(file = here::here("models/first_model.rds"))
```

```{r}
#| echo: false
#| eval: true
#| label: tbl-modelresults
#| tbl-cap: "Explanatory models of flight time based on wing width and wing length"
#| warning: false

#modelsummary::modelsummary(
#  list(
#    "First model" = first_model
 # ),
 # statistic = "mad",
 # fmt = 2
#)
```




# Discussion

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

Please don't use these as sub-heading labels - change them to be what your point actually is.

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional data details

# Model details {#sec-model-details}

## Posterior predictive check

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check. This shows...

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. This shows... 

```{r}
#| eval: true
#| echo: false
#| message: false
#| warning: false
#| label: fig-ppcheckandposteriorvsprior
#| layout-ncol: 2
#| fig-cap: "Examining how the model fits, and is affected by, the data"
#| fig-subcap: ["Posterior prediction check", "Comparing the posterior with the prior"]

#pp_check(first_model) +
#  theme_classic() +
#  theme(legend.position = "bottom")

#posterior_vs_prior(first_model) +
#  theme_minimal() +
 # scale_color_brewer(palette = "Set1") +
#  theme(legend.position = "bottom") +
#  coord_flip()
```

## Diagnostics

@fig-stanareyouokay-1 is a trace plot. It shows... This suggests...

@fig-stanareyouokay-2 is a Rhat plot. It shows... This suggests...

```{r}
#| echo: false
#| eval: true
#| message: false
#| warning: false
#| label: fig-stanareyouokay
#| fig-cap: "Checking the convergence of the MCMC algorithm"
#| fig-subcap: ["Trace plot", "Rhat plot"]
#| layout-ncol: 2

#plot(first_model, "trace")

#plot(first_model, "rhat")
```



\newpage


# References


